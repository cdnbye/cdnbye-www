(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{834:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("h4",{attrs:{id:"绑定域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绑定域名"}},[s._v("#")]),s._v(" 绑定域名")]),s._v(" "),a("p",[s._v("在使用P2P服务之前，需要先"),a("RouterLink",{attrs:{to:"/cn/views/bindings.html"}},[s._v("绑定域名")]),s._v("。")],1),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("Localhost 已加入白名单，无需绑定，用于本地调试。")])]),s._v(" "),a("h4",{attrs:{id:"网站迁移到https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网站迁移到https"}},[s._v("#")]),s._v(" 网站迁移到HTTPS")]),s._v(" "),a("p",[s._v("由于基于 Service Worker 的引擎需要在HTTPS下才能生效，请确保你的网站已经迁移到HTTPS，如果只使用基于 hls.js 的引擎则可以忽略。")]),s._v(" "),a("h2",{attrs:{id:"部署本地代理-sw-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署本地代理-sw-js"}},[s._v("#")]),s._v(" 部署本地代理(sw.js)")]),s._v(" "),a("p",[s._v("为了安全起见，浏览器不允许其他域名的脚本调用 ServiceWorker ，因此需要将脚本文件置于网站同一域名下，P2P功能才能正常工作，具体操作如下：")]),s._v(" "),a("h3",{attrs:{id:"如果网站不是pwa"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果网站不是pwa"}},[s._v("#")]),s._v(" 如果网站不是PWA")]),s._v(" "),a("p",[s._v("拷贝 "),a("a",{attrs:{href:"https://github.com/swarm-cloud/hls-p2p-engine/blob/main/demo/sw.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("sw.js"),a("OutboundLink")],1),s._v(" 到服务器的播放器所在目录， 并确保可以通过公网访问如 "),a("em",[a("strong",[s._v("https://your_website.com/sw.js")])]),s._v(" 。\n您也可以下载"),a("a",{attrs:{href:"https://cdn.jsdelivr.net/npm/swarmcloud-hls@latest/dist/hls-proxy.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("hls-proxy.js"),a("OutboundLink")],1),s._v(" 本地化并改名为 sw.js 。")]),s._v(" "),a("h3",{attrs:{id:"如果网站是pwa"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果网站是pwa"}},[s._v("#")]),s._v(" 如果网站是PWA")]),s._v(" "),a("p",[s._v("在网站根目录的 "),a("em",[a("strong",[s._v("sw.js")])]),s._v(" 文件的第一行增加以下代码：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("importScripts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://cdn.jsdelivr.net/npm/swarmcloud-hls@latest/dist/hls-proxy.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("并且在 SDK 配置正确的 sw.js 路径")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" p2pConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     swFile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PATH_TO_SW_FILE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v('部署完成后，1）您的网站之前 sw.js 的逻辑将继续正常执行；2）SwarmCloud 的 ServiceWorker 脚本将监听"fetch"事件进而拦截HLS请求，其他请求将被之前的 ServiceWorker 的逻辑处理。')]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("如果仅使用hls.js，则不需要部署HTTPS或者本地代理(sw.js)")])]),s._v(" "),a("h2",{attrs:{id:"引入插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入插件"}},[s._v("#")]),s._v(" 引入插件")]),s._v(" "),a("h4",{attrs:{id:"script标签引入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#script标签引入"}},[s._v("#")]),s._v(" Script标签引入")]),s._v(" "),a("p",[s._v("通过script标签引入已经和hls.js打包的最新版本：")]),s._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://cdn.jsdelivr.net/npm/swarmcloud-hls@latest/dist/hls.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),a("p",[s._v("或者引入没有与hls.js打包的独立版本：")]),s._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://cdn.jsdelivr.net/npm/hls.js@0.14.17"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://cdn.jsdelivr.net/npm/swarmcloud-hls@latest/dist/p2p-engine.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),a("h4",{attrs:{id:"文件引入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件引入"}},[s._v("#")]),s._v(" 文件引入")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/swarm-cloud/hls-p2p-engine/releases/download/v2.0.0/dist.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击"),a("OutboundLink")],1),a("br"),s._v("注意js代码需要放在播放器代码之前执行，可以在引入播放器代码的script标签之前引入。")]),s._v(" "),a("h4",{attrs:{id:"browserify-webpack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#browserify-webpack"}},[s._v("#")]),s._v(" Browserify / Webpack")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --save swarmcloud-hls\n")])])]),a("p",[s._v("在播放器模块中通过 "),a("em",[a("strong",[s._v("require")])]),s._v(" 引入：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" Hls "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'swarmcloud-hls/dist/hls.min'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 或者引入P2pEngineHls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" P2pEngineHls "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'swarmcloud-hls/dist/p2p-engine.min'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("或者使用ES6的 "),a("em",[a("strong",[s._v("import")])]),s._v(" 语法：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Hls "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'swarmcloud-hls/dist/hls.min'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 或者引入P2pEngineHls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" P2pEngineHls "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'swarmcloud-hls/dist/p2p-engine.min'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"使用插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用插件"}},[s._v("#")]),s._v(" 使用插件")]),s._v(" "),a("h4",{attrs:{id:"bundled-sdk-已经整合了-p2p-插件的hls-js库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bundled-sdk-已经整合了-p2p-插件的hls-js库"}},[s._v("#")]),s._v(" Bundled SDK(已经整合了 P2P 插件的Hls.js库)")]),s._v(" "),a("p",[s._v("在 "),a("em",[a("strong",[s._v("hlsjsConfig")])]),s._v(" 对象字面量中加入 "),a("em",[a("strong",[s._v("p2pConfig")])]),s._v(" 字段，然后在实例化hls.js时把 "),a("em",[a("strong",[s._v("hlsjsConfig")])]),s._v(" 作为参数传入。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" p2pConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    logLevel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'debug'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Other p2pConfig options if applicable")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isSupported")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" hlsjsConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Other hlsjsConfig options provided by hls.js")]),s._v("\n        p2pConfig\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Hls constructor is overriden by included bundle")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" hls "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Hls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hlsjsConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Use hls just like the usual hls.js ...")]),s._v("\n    hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadSource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("contentUrl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("attachMedia")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// use ServiceWorker based p2p engine if hls.js is not supported")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("P2pEngine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p2pConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// equal to  new Hls.P2pEngine.ServiceWorkerEngine(p2pConfig);")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),a("h4",{attrs:{id:"wrapper-没有打包-hls-js-的插件-需要自己引入-hls-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wrapper-没有打包-hls-js-的插件-需要自己引入-hls-js"}},[s._v("#")]),s._v(" Wrapper(没有打包 Hls.js 的插件，需要自己引入 Hls.js）")]),s._v(" "),a("p",[s._v("实例化hls.js并将 "),a("em",[a("strong",[s._v("hlsjsConfig")])]),s._v(" 作为参数传入。然后实例化 "),a("em",[a("strong",[s._v("P2pEngineHls")])]),s._v(" 并将 "),a("em",[a("strong",[s._v("p2pConfig")])]),s._v(" 作为参数传入。调用hls.js的 "),a("em",[a("strong",[s._v("loadSource")])]),s._v(" 和 "),a("em",[a("strong",[s._v("attachMedia")])]),s._v(" 方法。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" hlsjsConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    maxBufferSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Highly recommended setting in live mode")]),s._v("\n    maxBufferLength"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Highly recommended setting in live mode")]),s._v("\n    liveSyncDurationCount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Highly recommended setting in live mode")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" p2pConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Other p2pConfig options if applicable")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("P2pEngineHls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isMSESupported")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" hls "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Hls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hlsjsConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    p2pConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hlsjsInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// set hlsjs instance to SDK")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Use hls just like your usual hls.js…")]),s._v("\n    hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadSource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("contentUrl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("attachMedia")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Hls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Events"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MANIFEST_PARSED")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("P2pEngineHls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p2pConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",[s._v("如果音频和视频轨分离，或者媒体文件是由多个服务器生成的，为避免冲突，请增加以下配置：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" p2pConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    strictSegmentId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])]),s._v(" "),a("h2",{attrs:{id:"引擎的切换原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引擎的切换原理"}},[s._v("#")]),s._v(" 引擎的切换原理")]),s._v(" "),a("p",[s._v("SDK在实例化时，会优先尝试使用基于 hls.js 的引擎（以下简称MSE引擎），如果不成功则尝试基于 ServiceWorker 的引擎（以下简称SW引擎），具体如下：")]),s._v(" "),a("ul",[a("li",[s._v("如果浏览器不支持 WebRTC Datachannel，则不启用任何P2P引擎")]),s._v(" "),a("li",[s._v("如果浏览器支持 MSE 并且 传入了 hlsjsInstance 并且没有设置 proxyOnly，则尝试启用MSE引擎")]),s._v(" "),a("li",[s._v("否则在支持 ServiceWorker 的情况下启用SW引擎")])]),s._v(" "),a("h2",{attrs:{id:"播放器集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#播放器集成"}},[s._v("#")]),s._v(" 播放器集成")]),s._v(" "),a("p",[s._v("参考"),a("RouterLink",{attrs:{to:"/cn/views/hls-de/players.html"}},[s._v("播放器示例")]),s._v("。")],1),s._v(" "),a("h2",{attrs:{id:"electron"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#electron"}},[s._v("#")]),s._v(" Electron")]),s._v(" "),a("p",[s._v("本插件同样支持 "),a("a",{attrs:{href:"https://electronjs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Electron"),a("OutboundLink")],1),s._v(" 平台，只需求将从管理面板获取的token等信息传进config中即可，如下所示：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" hlsjsConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    p2pConfig"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        token"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("YOUR_TOKEN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("YOUR_APP_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用的名称")]),s._v("\n        appId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("YOUR_APP_ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 需要与管理面板输入的保持一致")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Other p2pConfig options if applicable")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("参考"),a("RouterLink",{attrs:{to:"/cn/views/bindings.html#绑定-app-id-并获取token"}},[s._v("如何获取token")])],1)])}),[],!1,null,null,null);t.default=e.exports}}]);