(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{863:function(t,a,e){"use strict";e.r(a);var s=e(1),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),e("p",[t._v("P2P效果受多种因素影响，包括：缓冲时长、码率高低、编码方式、网络运营商、用户地理分布、终端设备性能等等。\n"),e("br"),t._v("\nm3u8的配置(或者mpd)对P2P效果也会产生很大的影响，适当的配置（包括每个切片的时长和每个m3u8/mpd包含的切片数量等）可以显著提高P2P率。建议不要使用多码率m3u8/mpd。")]),t._v(" "),e("h2",{attrs:{id:"直播模式m3u8-mpd参考配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#直播模式m3u8-mpd参考配置"}},[t._v("#")]),t._v(" 直播模式m3u8/mpd参考配置")]),t._v(" "),e("ul",[e("li",[t._v("切片时长：3到4秒")]),t._v(" "),e("li",[t._v("每个m3u8/mpd切片数量：不少于10个")])]),t._v(" "),e("p",[t._v("以NGINX为例:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("rtmp {\n    server {\n        ...\n\n        application show {\n            ...\n\n            hls_fragment 4;                # 4 seconds fragments\n            hls_playlist_length 60;        # 60 seconds playlist\n\n        }\n    }\n}\n")])])]),e("h2",{attrs:{id:"允许http-range请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#允许http-range请求"}},[t._v("#")]),t._v(" 允许Http Range请求")]),t._v(" "),e("p",[t._v("Http Range请求用于下载指定范围的数据，可以在一部分数据已用P2P下载的情况下，剩余部分用http下载补足。如果从对等端P2P下载速度较慢，那么在达到超时时间后，就可以把剩余数据交给http range请求下载，而不需要重新完整下载整个数据，从而节省CDN的带宽，下图阐述了不采用和采用Http Range的区别：\n"),e("br"),t._v(" "),e("img",{attrs:{width:"600",src:"https://www.cdnbye.com/pics/http-range.png",alt:"http-range"}}),t._v(" "),e("br"),t._v("\n要启动Http Range请求，需要同时在源伺服器和CDN开启OPTIONS和RANGE请求：(Native端不需要开启OPTIONS)")]),t._v(" "),e("h4",{attrs:{id:"options请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#options请求"}},[t._v("#")]),t._v(" OPTIONS请求")]),t._v(" "),e("p",[t._v("OPTIONS请求是浏览器在跨域情况下发起Range请求之前的预检请求，一般只需要配置伺服器使Http头有以下响应：(安卓和iOS不需要配置)")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Access-Control-Allow-Methods: GET, OPTIONS\n")])])]),e("h4",{attrs:{id:"range请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#range请求"}},[t._v("#")]),t._v(" RANGE请求")]),t._v(" "),e("p",[t._v("要开启RANGE请求，一般只需要配置伺服器使Http头有以下响应：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Access-Control-Allow-Headers: Range\n")])])]),e("h4",{attrs:{id:"nginx-示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx-示例"}},[t._v("#")]),t._v(" NGINX 示例")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';\nadd_header 'Access-Control-Allow-Headers' 'Range';\nadd_header 'Access-Control-Allow-Origin' '*';\nadd_header Accept-Ranges bytes;\n# allow CORS preflight requests\nif ($request_method = 'OPTIONS') {\n    add_header 'Access-Control-Allow-Headers' 'Range';\n    add_header 'Access-Control-Max-Age' 1728000;\n    add_header 'Content-Type' 'text/plain charset=UTF-8';\n    add_header 'Content-Length' 0;\n    return 204;\n}\n")])])]),e("h2",{attrs:{id:"web-sdk配置建议"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-sdk配置建议"}},[t._v("#")]),t._v(" Web SDK配置建议")]),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/cn/views/hls-de/API.html#在-sw-js-设置播放时间偏移量"}},[t._v("设置播放时间偏移量")])],1)]),t._v(" "),e("h2",{attrs:{id:"安卓sdk配置建议"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安卓sdk配置建议"}},[t._v("#")]),t._v(" 安卓SDK配置建议")]),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/cn/views/android/v3/API.html#回调播放器信息"}},[t._v("将播放缓冲信息回调给SDK")])],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/cn/views/android/v3/API.html#设置播放时间偏移量"}},[t._v("设置播放时间偏移量")])],1)]),t._v(" "),e("h2",{attrs:{id:"部署超级节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署超级节点"}},[t._v("#")]),t._v(" 部署超级节点")]),t._v(" "),e("p",[t._v("请参考"),e("RouterLink",{attrs:{to:"/cn/views/super-peer.html"}},[t._v("这里")])],1)])}),[],!1,null,null,null);a.default=r.exports}}]);