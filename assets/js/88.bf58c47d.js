(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{656:function(t,a,e){"use strict";e.r(a);var n=e(1),s=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"实例化-p2penginesw"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实例化-p2penginesw"}},[t._v("#")]),t._v(" 实例化 P2PEngineSW")]),t._v(" "),e("h3",{attrs:{id:"var-engine-new-p2penginesw-p2pconfig"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#var-engine-new-p2penginesw-p2pconfig"}},[t._v("#")]),t._v(" var engine = new P2PEngineSW(p2pConfig);")]),t._v(" "),e("p",[t._v("创建一个 "),e("em",[e("strong",[t._v("P2PEngineSW")])]),t._v(" 实例。")]),t._v(" "),e("p",[t._v("如果指定了 "),e("em",[e("strong",[t._v("p2pConfig")])]),t._v(" ，那么对应的默认值将会被覆盖。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("字段")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("默认值")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("logLevel")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string|boolean")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("'error'")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("log的等级，分为warn、error、none，设为true等于warn，设为false等于none。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("token")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("undefined")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("RouterLink",{attrs:{to:"/cn/views/bindings.html"}},[t._v("token")]),t._v("用于控制台多域名数据汇总展示，另外如果自定义channelId也需要设置token。")],1)]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("announce")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("'https://tracker.cdnbye.com/v1'")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("tracker服务器地址。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("p2pEnabled")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("boolean")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("true")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("是否开启P2P。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("webRTCConfig")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("Object")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("{}")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("用于配置stun和datachannel的"),e("a",{attrs:{href:"https://github.com/feross/simple-peer",target:"_blank",rel:"noopener noreferrer"}},[t._v("字典"),e("OutboundLink")],1),t._v("。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("tag")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("''")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("用户自定义标签。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("swFile")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("'sw.js'")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("ServiceWorker文件名.")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("swScope")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("'./'")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("ServiceWorker默认作用域是当前目录以及所有子目录，因此如果将 sw.js 放在网站根目录，那么所有网站请求都在 ServiceWorker 控制范围内。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("swEnabled")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("boolean")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("true")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("开启或关闭ServiceWorker.")])])])]),t._v(" "),e("h2",{attrs:{id:"实例化-peerworker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实例化-peerworker"}},[t._v("#")]),t._v(" 实例化 PeerWorker")]),t._v(" "),e("h3",{attrs:{id:"var-worker-new-peerworker-swconfig"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#var-worker-new-peerworker-swconfig"}},[t._v("#")]),t._v(" var worker = new PeerWorker(swConfig);")]),t._v(" "),e("p",[t._v("创建一个 "),e("em",[e("strong",[t._v("PeerWorker")])]),t._v(" 实例。\nPeerWorker 是 ServiceWorker 封装， 用于拦截全站的网络请求，并在P2P和CDN之间智能切换。")]),t._v(" "),e("p",[t._v("如果指定了 "),e("em",[e("strong",[t._v("swConfig")])]),t._v(" ，那么对应的默认值将会被覆盖。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("字段")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("默认值")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("version")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("number")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("1")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("IndexedDB 的版本号, 增加版本号将更新所有缓存")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("logLevel")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string|boolean")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("'error'")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("同 P2PEngineSW logLevel")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("allowOrigins")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("[]")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("允许代理的第三方资源Origin")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("allowDestinations")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("['audio', 'embed', 'font', 'image', 'script', 'style', 'video']")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("允许P2P加速的资源类型，是一个request尝试获取的潜在内容类型，具体请参考"),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/RequestDestination",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("allowImageTypes")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("['bmp', 'bpg', 'eps', 'gif', 'ico', 'jpeg', 'jpg', 'pict', 'png', 'svg', 'svgz', 'tif', 'tiff', 'ttf', 'webp']")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("允许P2P加速的图片类型")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("allowVideoTypes")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("['3g2', '3gp', 'amv', 'avi', 'drc', 'f4bogv', 'f4p', 'f4v', 'flv', 'gifv', 'm2v', 'm4v', 'mkv', 'mov', 'mp2', 'mpe', 'mpeg', 'mpg', 'mpv', 'qt', 'webm', 'wmv']")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("允许P2P加速的视频类型")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("allowAudioTypes")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("['aac', 'aiff', 'f4a', 'flac', 'm4a', 'm4p', 'mid', 'midi', 'mogg', 'mp3', 'oga', 'ogg', 'opus', 'pat', 'ra', 'rm', 'wav', 'webm']")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("允许P2P加速的音频类型")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("allowDocumentTypes")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("['js', 'css', 'doc', 'docx', 'otf', 'pdf', 'ppt', 'pptx', 'ps', 'xls', 'xlsx', 'wasm', 'wat']")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("允许P2P加速的文档类型")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("allowOtherTypes")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("array")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("['swf', 'woff', 'woff2', 'eot']")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("除了以上类型外允许P2P加速的其它类型")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("maxEntries")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("number")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("300")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("最大缓存文件个数")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("maxAgeSeconds")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("number")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("24 * 60 * 60")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("缓存数据的过期时间，过期后将会被懒删除（单位：秒）")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("fileSizeLimit")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("number")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("10 * 1024 * 1024")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("单个文件大小限制(Byte)")])])])]),t._v(" "),e("h2",{attrs:{id:"p2penginesw-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#p2penginesw-api"}},[t._v("#")]),t._v(" P2PEngineSW API")]),t._v(" "),e("h4",{attrs:{id:"p2penginesw-version-static"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#p2penginesw-version-static"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("P2PEngineSW.version")])]),t._v(" (static)")]),t._v(" "),e("p",[t._v("获取 P2PEngineSW 的版本号。")]),t._v(" "),e("h4",{attrs:{id:"p2penginesw-protocolversion-static"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#p2penginesw-protocolversion-static"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("P2PEngineSW.protocolVersion")])]),t._v(" (static)")]),t._v(" "),e("p",[t._v("获取 P2P 协议的版本号。")]),t._v(" "),e("h4",{attrs:{id:"p2penginesw-issupported-static-method"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#p2penginesw-issupported-static-method"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("P2PEngineSW.isSupported() (static method)")])])]),t._v(" "),e("p",[t._v("判断当前浏览器是否支持WebRTC datachannel 和 ServiceWorker。")]),t._v(" "),e("h4",{attrs:{id:"engine-registerserviceworker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-registerserviceworker"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.registerServiceWorker()")])])]),t._v(" "),e("p",[t._v("注册 ServiceWorker 并返回一个 promise。")]),t._v(" "),e("h4",{attrs:{id:"engine-start"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-start"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.start()")])])]),t._v(" "),e("p",[t._v("启动engine。")]),t._v(" "),e("h4",{attrs:{id:"engine-stop"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-stop"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.stop()")])])]),t._v(" "),e("p",[t._v("停止 p2p 并释放资源。")]),t._v(" "),e("h2",{attrs:{id:"p2penginesw-事件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#p2penginesw-事件"}},[t._v("#")]),t._v(" P2PEngineSW 事件")]),t._v(" "),e("h4",{attrs:{id:"engine-on-peerid-function-peerid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-on-peerid-function-peerid"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.on('peerId', function (peerId) {})")])])]),t._v(" "),e("p",[t._v("当从服务端获取到peerId时回调该事件。")]),t._v(" "),e("h4",{attrs:{id:"engine-on-peers-function-peers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-on-peers-function-peers"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.on('peers', function (peers) {})")])])]),t._v(" "),e("p",[t._v("当与新的节点成功建立p2p连接时回调该事件。")]),t._v(" "),e("h4",{attrs:{id:"engine-on-stats-function-stats"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-on-stats-function-stats"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.on('stats', function (stats) {})")])])]),t._v(" "),e("p",[t._v("该回调函数可以获取p2p信息，包括："),e("br"),t._v("\nstats.totalHTTPDownloaded: 从HTTP(CDN)下载的数据量（单位KB）"),e("br"),t._v("\nstats.totalP2PDownloaded: 从P2P下载的数据量（单位KB）"),e("br"),t._v("\nstats.totalP2PUploaded: P2P上传的数据量（单位KB）"),e("br"),t._v("\nstats.p2pDownloadSpeed: P2P下载速度（单位KB/s）")]),t._v(" "),e("h3",{attrs:{id:"engine-on-serverconnected-function-connected"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-on-serverconnected-function-connected"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.on('serverConnected', function (connected) {})")])])]),t._v(" "),e("p",[t._v("当连接/断开websocket时回调该事件。")]),t._v(" "),e("h3",{attrs:{id:"engine-on-exception-function-e"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#engine-on-exception-function-e"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("engine.on('exception', function (e) {})")])])]),t._v(" "),e("p",[t._v("该回调函数可以获取SDK的异常信息，包括："),e("br"),t._v("\ne.code: 异常标识（TRACKER_EXPT SIGNAL_EXPT）"),e("br"),t._v("\ne.message: 异常信息 "),e("br"),t._v("\ne.stack: 异常堆栈信息 "),e("br")]),t._v(" "),e("h3",{attrs:{id:"通过p2pconfig获取p2p信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过p2pconfig获取p2p信息"}},[t._v("#")]),t._v(" 通过p2pConfig获取p2p信息")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("p2pConfig"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getStats")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("totalP2PDownloaded"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" totalP2PUploaded"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" totalHTTPDownloaded"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p2pDownloadSpeed")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取p2p下载信息")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getPeerId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("peerId")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取本节点的Id")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getPeersInfo")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("peers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取成功连接的节点的信息")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"peerworker-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#peerworker-api"}},[t._v("#")]),t._v(" PeerWorker API")]),t._v(" "),e("h4",{attrs:{id:"peerworker-version-static"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#peerworker-version-static"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("PeerWorker.version")])]),t._v(" (static)")]),t._v(" "),e("p",[t._v("获取 PeerWorker 的版本号。")]),t._v(" "),e("h4",{attrs:{id:"worker-register"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#worker-register"}},[t._v("#")]),t._v(" "),e("em",[e("strong",[t._v("worker.register()")])])]),t._v(" "),e("p",[t._v("注册 service worker 事件监听。")]),t._v(" "),e("h2",{attrs:{id:"高级用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#高级用法"}},[t._v("#")]),t._v(" 高级用法")]),t._v(" "),e("h3",{attrs:{id:"第三方资源加速"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三方资源加速"}},[t._v("#")]),t._v(" 第三方资源加速")]),t._v(" "),e("p",[t._v('许多网站会从其它域名加载资源，比如从 https://fonts.googleapis.com/ 加载 google 字体。这种即所谓的"跨域资源请求"，需要同时满足以下三个条件，才能进行P2P加速：')]),t._v(" "),e("ul",[e("li",[t._v("在 PeerWorker 配置 "),e("em",[e("strong",[t._v("allowOrigins")])]),t._v(" ，加上需要加速的第三方Origin：")])]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" worker "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PeerWorker")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    allowOrigins"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://third-party-site.com'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("ul",[e("li",[t._v("确保第三方资源响应已经加上了跨域头，如：")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Access-Control-Allow-Origin: *\n")])])]),t._v(" "),e("h3",{attrs:{id:"忽略不适合共享的数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#忽略不适合共享的数据"}},[t._v("#")]),t._v(" 忽略不适合共享的数据")]),t._v(" "),e("p",[t._v("一些数据不适合或者没必要共享，比如用户特定的数据等，这时候可以通过 "),e("em",[e("strong",[t._v("shouldCacheDataWithUrl")])]),t._v(" 来过滤掉这些URL：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" worker "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PeerWorker")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("shouldCacheDataWithUrl")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" regex "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/user/.+'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regex"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ignore url path match /user/*")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"强制更新资源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#强制更新资源"}},[t._v("#")]),t._v(" 强制更新资源")]),t._v(" "),e("p",[t._v("由于静态资源默认缓存24小时，如果需要更新后立即生效，需要强制刷新缓存。可以通过递增 PeerWorker 版本号来实现：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" worker "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PeerWorker")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    version"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nworker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h3",{attrs:{id:"跨域名p2p互通"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#跨域名p2p互通"}},[t._v("#")]),t._v(" 跨域名P2P互通")]),t._v(" "),e("p",[t._v("默认情况下只有同个域名的节点才能P2P互通，如果要跨网站资源共享，可以自定义频道ID：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须先在 p2pConfig 设置 token ，才能自定义 channelId !")]),t._v("\np2pConfig"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    token"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("YOUR_TOKEN")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("channelId")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("YOUR_CHANNEL_ID")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("generateStoreKey")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" range")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseRangeHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("rangeHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" normalizedRangeHeader "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rangeHeader"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rangeParts "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token regex"}},[e("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("(\\d*)-(\\d*)")]),e("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("normalizedRangeHeader"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                start"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" rangeParts"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Number")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rangeParts"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                end"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" rangeParts"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Number")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rangeParts"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" netUrl "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 由于本域名的资源的key默认是相对路径，在跨域名共享之前需要先还原成完整的路径")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("netUrl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("startsWith")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            netUrl "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" location"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" netUrl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("range"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" start"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" end "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseRangeHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("range"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" end"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("netUrl"),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("start "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("end "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("netUrl"),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"自行配置-stun-和-turn-服务器地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自行配置-stun-和-turn-服务器地址"}},[t._v("#")]),t._v(" 自行配置 STUN 和 TURN 服务器地址")]),t._v(" "),e("p",[t._v("STUN用于p2p连接过程中获取公网IP地址，TURN则可以在p2p连接不通时用于中转数据。本SDK已内置公开的STUN服务，开发者可以通过P2pConfig来更换STUN地址。TURN服务器则需要开发者自行搭建，可以参考"),e("a",{attrs:{href:"https://github.com/coturn/coturn",target:"_blank",rel:"noopener noreferrer"}},[t._v("coturn"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("p2pConfig"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    webRTCConfig"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       iceServers"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n           "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" urls"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("YOUR_STUN_OR_TURN_SERVER")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=s.exports}}]);